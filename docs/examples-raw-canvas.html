<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Raw Canvas Example · Mappa.js</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Raw Canvas Example · Mappa.js"/><meta property="og:type" content="website"/><meta property="og:url" content="https://mappa.js.org/index.html"/><meta property="og:description" content="Visualizing the 5000 largest recorded meteorite landings in the world using [Mappa](/docs/getting-started.html) and and [Mapbox](https://www.mapbox.com/mapbox.js/api/v3.1.1/)."/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"/><script type="text/javascript" src="/js/stars.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/addons/p5.dom.min.js"></script><script type="text/javascript" src="/js/mappa.min.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png"/><h2 class="headerTitle">Mappa.js</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/docs/getting-started.html" target="_self">Getting Started</a></li><li><a href="/docs/api-mappa.html" target="_self">API Reference</a></li><li><a href="/docs/examples-google-maps.html" target="_self">Examples</a></li><li><a href="/docs/introduction-to-web-maps.html" target="_self">Tutorials</a></li><li><a href="https://github.com/cvalenzuela/Mappa" target="_self">Star</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Examples</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/docs/getting-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/simple-map.html">Simple Map</a></li><li class="navListItem"><a class="navItem" href="/docs/using-data.html">Using Data</a></li><li class="navListItem"><a class="navItem" href="/docs/tldr-p5.html">tl;dr with p5.js</a></li></ul></div><div class="navGroup navGroupActive"><h3>Examples</h3><ul><li class="navListItem"><a class="navItem" href="/docs/examples-google-maps.html">Google Maps</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-mapbox.html">Mapbox</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-mapboxGL.html">MapboxGL</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-leaflet.html">Leaflet</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-three-js.html">Three.js</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/examples-raw-canvas.html">Raw Canvas</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-google-maps-static.html">Static Google Maps</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-mapbox-static.html">Static Mapbox</a></li><li class="navListItem"><a class="navItem" href="/docs/examples-mapquest-static.html">Static Mapquest</a></li></ul></div><div class="navGroup navGroupActive"><h3>Tutorials</h3><ul><li class="navListItem"><a class="navItem" href="/docs/introduction-to-web-maps.html">Introduction to Web Maps</a></li><li class="navListItem"><a class="navItem" href="/docs/taxi-routes.html">Taxi Routes</a></li><li class="navListItem"><a class="navItem" href="/docs/animated-meteorite-landings.html">Animated Meteorite Landings</a></li><li class="navListItem"><a class="navItem" href="/docs/zipdecode-with-static-maps.html">Zipdecode with Static Maps</a></li><li class="navListItem"><a class="navItem" href="/docs/zipdecode-with-tile-maps.html">Zipdecode with Tie Maps</a></li><li class="navListItem"><a class="navItem" href="/docs/co2-pollution-map.html">CO2 Pollution Map</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Raw Canvas Example</h1></header><article><div><span><p>Visualizing the 5000 largest recorded meteorite landings in the world using <a href="/docs/getting-started.html">Mappa</a> and and <a href="https://www.mapbox.com/mapbox.js/api/v3.1.1/">Mapbox</a>.</p>
<p><em>Data: <a href="https://data.nasa.gov/Space-Science/Meteorite-Landings/gh4g-9sfh">NASA Open Data Portal</a>.</em></p>
<h2><a class="anchor" aria-hidden="true" name="demo"></a><a href="#demo" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Demo</h2>
<div class="example">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.2/d3.min.js"></script>
  <canvas id="canvas" width='640' height='580'></canvas>
  <script src="assets/scripts/tile-raw-canvas.js"></script>
</div>
<h2><a class="anchor" aria-hidden="true" name="code"></a><a href="#code" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Code</h2>
<p>Get it from <a href="https://github.com/cvalenzuela/Mappa/tree/master/examples/tile/raw_canvas">here</a></p>
<pre><code class="hljs css javascript"><span class="hljs-comment">// API Key for MapboxGL. Get one here:</span>
<span class="hljs-comment">// https://www.mapbox.com/studio/account/tokens/</span>
<span class="hljs-keyword">const</span> key = <span class="hljs-string">'pk.eyJ1IjoibWFwcGF1c2VyIiwiYSI6ImNqNXNrbXIyZDE2a2cyd3J4Ym53YWxieXgifQ.JENDJqKE1SLISxL3Q_T22w'</span>;
<span class="hljs-comment">// Create an instance of Mapboxgl</span>
<span class="hljs-keyword">const</span> mappa = <span class="hljs-keyword">new</span> Mappa(<span class="hljs-string">'MapboxGL'</span>, key);

<span class="hljs-keyword">let</span> meteorites = [];
<span class="hljs-keyword">let</span> dataLoaded = <span class="hljs-literal">false</span>;

<span class="hljs-keyword">const</span> canvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"canvas"</span>);
<span class="hljs-keyword">const</span> ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

<span class="hljs-comment">// Options for map</span>
<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">lat</span>: <span class="hljs-number">-26.001513</span>,
  <span class="hljs-attr">lng</span>: <span class="hljs-number">-14.3507</span>,
  <span class="hljs-attr">zoom</span>: <span class="hljs-number">2.1</span>,
  <span class="hljs-attr">style</span>: <span class="hljs-string">'mapbox://styles/mapbox/traffic-night-v2'</span>,
  <span class="hljs-attr">pitch</span>: <span class="hljs-number">50</span>,
};

<span class="hljs-keyword">const</span> myMap = mappa.tileMap(options);

<span class="hljs-comment">// Make a circle</span>
<span class="hljs-keyword">const</span> circle = <span class="hljs-function">(<span class="hljs-params">x, y, s</span>) =&gt;</span> {
  ctx.beginPath();
  ctx.arc(x, y, s, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI);
  ctx.stroke();
  ctx.fillStyle = <span class="hljs-string">"#00ff1f"</span>;
  ctx.fill();
};

<span class="hljs-comment">// Convert a range</span>
<span class="hljs-keyword">const</span> convertRange = <span class="hljs-function">(<span class="hljs-params">value, r1, r2</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> (value - r1[<span class="hljs-number">0</span>]) * (r2[<span class="hljs-number">1</span>] - r2[<span class="hljs-number">0</span>]) / (r1[<span class="hljs-number">1</span>] - r1[<span class="hljs-number">0</span>]) + r2[<span class="hljs-number">0</span>];
};

<span class="hljs-comment">// Draw the meteorites</span>
<span class="hljs-keyword">const</span> drawData = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// Clear the canvas</span>
  ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.width, canvas.height);

  meteorites.forEach(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> mass = convertRange(e.size, [<span class="hljs-number">558</span>, <span class="hljs-number">60000000</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">15</span>]);
    <span class="hljs-keyword">const</span> pos = myMap.latLngToPixel(e.lat, e.lng);
    circle(pos.x, pos.y, mass);
  });
};

<span class="hljs-comment">// Load the data using d3.js</span>
d3.csv(<span class="hljs-string">"assets/data/Meteorite_Landings.csv"</span>, d =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">lat</span>: <span class="hljs-built_in">Number</span>(d.reclat),
    <span class="hljs-attr">lng</span>: <span class="hljs-built_in">Number</span>(d.reclong),
    <span class="hljs-attr">size</span>: <span class="hljs-built_in">Number</span>(d[<span class="hljs-string">'mass (g)'</span>]),
  }
}, data =&gt; {
  meteorites = data;
  drawData();
});

myMap.overlay(canvas);
myMap.onChange(drawData);
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="examples-three-js.html">← Three.js Example</a><a class="docs-next button" href="examples-google-maps-static.html">Static Google Maps Example →</a></div></div></div></div></div></body></html>